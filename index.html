<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My ROS Dashboard</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
</head>
<body>
    <h1>ROS Web Dashboard</h1>
    
    <!-- Robot position -->
    <div id="robot_position" style="margin-bottom:20px;"></div>

    <!-- Gazebo camera stream -->
    <iframe src="http://localhost:8080/stream?topic=/waffle_pi/camera/rgb/image_raw"
            width="640" height="480" style="border:1px solid #000;">
    </iframe>

    <!-- Velocity box -->
    <div id="cmdvel-box"
         style="width:640px;height:50px;border:1px solid #000;margin-top:20px;padding:10px;">
        Waiting for /waffle_pi/cmd_vel messages...
    </div>

    <script type="text/javascript">
        // Connect to the rosbridge WebSocket server
        var ros = new ROSLIB.Ros({
            url: 'ws://localhost:9090'  // assuming rosbridge runs locally
        });
        
        // Subscribe to the robot's pose topic
        var poseListener = new ROSLIB.Topic({
            ros: ros,
            name: '/robot_pose',
            messageType: 'geometry_msgs/Pose'
        });
        
        poseListener.subscribe(function(message) {
            document.getElementById('robot_position').innerHTML =
                `Position: x=${message.position.x.toFixed(2)}, y=${message.position.y.toFixed(2)}, z=${message.position.z.toFixed(2)}`;
        });

        // Subscribe to the waffle_pi cmd_vel topic
        var cmdVelListener = new ROSLIB.Topic({
            ros: ros,
            name: '/waffle_pi/cmd_vel',
            messageType: 'geometry_msgs/Twist'
        });

        cmdVelListener.subscribe(function(message) {
            document.getElementById("cmdvel-box").innerText =
                "Linear X: " + message.linear.x.toFixed(2) +
                " | Linear Y: " + message.linear.y.toFixed(2) +
                " | Linear Z: " + message.linear.z.toFixed(2) +
                " | Angular X: " + message.angular.x.toFixed(2) +
                " | Angular Y: " + message.angular.y.toFixed(2) +
                " | Angular Z: " + message.angular.z.toFixed(2);
        });
    </script>
</body>
</html>
